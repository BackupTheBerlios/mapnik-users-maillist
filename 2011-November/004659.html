<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mapnik-users] Ogcserver problems
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mapnik-users/2011-November/index.html" >
   <LINK REL="made" HREF="mailto:mapnik-users%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-users%5D%20Ogcserver%20problems&In-Reply-To=%3CCALrSKEdsb2zB3JW%2BpkggfpQwN5amVX-ZFCYMsZ0MXdCaYRjx2A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004658.html">
   <LINK REL="Next"  HREF="004660.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mapnik-users] Ogcserver problems</H1>
    <B>Espen Isaksen</B> 
    <A HREF="mailto:mapnik-users%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-users%5D%20Ogcserver%20problems&In-Reply-To=%3CCALrSKEdsb2zB3JW%2BpkggfpQwN5amVX-ZFCYMsZ0MXdCaYRjx2A%40mail.gmail.com%3E"
       TITLE="[Mapnik-users] Ogcserver problems">espen.isaksen at gmail.com
       </A><BR>
    <I>Wed Nov 16 22:13:12 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004658.html">[Mapnik-users] pdfprinter problem
</A></li>
        <LI>Next message: <A HREF="004660.html">[Mapnik-users] Ogcserver problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4659">[ date ]</a>
              <a href="thread.html#4659">[ thread ]</a>
              <a href="subject.html#4659">[ subject ]</a>
              <a href="author.html#4659">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I have been struggling with this for a long time now so I just have to
ask for help on the list.

I have set up ogcserver to read a Mapnik XML file(generated by
Tilemill), but I cannot get it to show me the correct output. All I
get now is a blank image.

The logs do not give an error:
localhost - - [16/Nov/2011 21:03:22] &quot;GET
///?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;BBOX=219492.741938,6633651.694955,221702.329041,6635588.780398&amp;CRS=EPSG:900913&amp;WIDTH=1045&amp;HEIGHT=917&amp;LAYERS=__all__&amp;STYLES=&amp;FORMAT=image/png&amp;DPI=72&amp;TRANSPARENT=TRUE
HTTP/1.1&quot; 200 3795

I don't think there is anything wrong with the projection as this file
works in Tilemill. I have tried both putting the EPSG code and the
full description in the top of the Mapnik XML file.

Can anybody give me some advice?



This is what I have:

wms_wsgi.py
#######################

#!/usr/bin/env python

import sys
from mapnik2.ogcserver.wsgi import WSGIApp
sys.path.append('/usr/lib/fcgi-bin/mapfactory.py')

application = WSGIApp('/usr/lib/fcgi-bin/ogcserver.conf')

# add these line to the bottom of your wsgi-based 'wms.py'

if __name__ == '__main__':
    from wsgiref.simple_server import make_server
    httpd = make_server('localhost', 8080, application)
    print &quot;Listening on port 8080....&quot;
    httpd.serve_forever()



mapfactory.py
#######################
import os
from ogcserver.WMS import BaseWMSFactory
from mapnik2 import Style, Layer, Map, load_map

class WMSFactory(BaseWMSFactory):
    def __init__(self):
        BaseWMSFactory.__init__(self)
        base_path, tail = os.path.split(__file__)
        file_path = os.path.join(base_path, '/home/espen/test.xml')
        self.loadXML(file_path)
        self.finalize()




ogcserver.conf
########################
# server: This section contains software related configuration parameters.

[server]

# module:  The module containing the MapFactory class.  See the readme for
#          details.
# This would be the name of the map_factory file (without extension .py)

module=mapfactory

# service: This section contains service level metadata.

[service]

# title: The title of the server.

title=Mapnik OGC Server

# abstract: An abstract describing the server.

abstract=This abstract describes the server and its contents.

# maxwidth, maxheight: The maximum size that a map will be supplied at.
#                      Exceeding it will raise an error in the client.

maxheight=5024
maxwidth=5024

# allowedepsgcodes:  The comma seperated list of epsg codes we want the server
#                    to support and advertise as supported in GetCapabilities.

allowedepsgcodes=4326,900913

# onlineresource:  A service level URL most likely pointing to the web site
#                  supporting the service for example.  This is NOT the online
#                  resource pointing to the CGI.

onlineresource=<A HREF="http://www.turkompisen.no/wms8080">http://www.turkompisen.no/wms8080</A>
baseurl=<A HREF="http://www.turkompisen.no/wms8080">http://www.turkompisen.no/wms8080</A>

# fees: An explanation of the fee structure for the usage of your service,
#       if any. Use the reserved keyword &quot;none&quot; if not applicable.

fees=

# keywords: A comma seperated list of key words.

keywordlist=

# accessconstraints: Plain language description of any constraints that might
#                    apply to the usage of your service, such as hours of
#                    operation.

accessconstraints=

# maxage:            The content of the HTTP Cache-Control header -
#                    the maximum age of the content in a cache, measured
#                    in seconds. One week is 604800 seconds, the default is
#                    1 day.
maxage=86400




test.xml
######################
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE Map[]&gt;
&lt;Map srs=&quot;+init=epsg:900913&quot; background-color=&quot;#b8dee6&quot;&gt;

&lt;FontSet name=&quot;fontset-0&quot;&gt;
  &lt;Font face-name=&quot;Ubuntu Regular&quot;/&gt;
  &lt;Font face-name=&quot;Arial Regular&quot;/&gt;
  &lt;Font face-name=&quot;DejaVu Sans Book&quot;/&gt;
&lt;/FontSet&gt;
&lt;Style name=&quot;shoreline_300&quot; filter-mode=&quot;first&quot;&gt;
  &lt;Rule&gt;
    &lt;MinScaleDenominator&gt;400000&lt;/MinScaleDenominator&gt;
    &lt;PolygonSymbolizer fill=&quot;#ffffff&quot; /&gt;
  &lt;/Rule&gt;
&lt;/Style&gt;
&lt;Layer name=&quot;shoreline_300&quot;
  srs=&quot;+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0
+x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs
+over&quot;&gt;
    &lt;StyleName&gt;shoreline_300&lt;/StyleName&gt;
    &lt;Datasource&gt;
       &lt;Parameter
name=&quot;file&quot;&gt;&lt;![CDATA[/home/espen/turkompisen/data/shoreline/shoreline_300.shp]]&gt;&lt;/Parameter&gt;
       &lt;Parameter name=&quot;type&quot;&gt;&lt;![CDATA[shape]]&gt;&lt;/Parameter&gt;
    &lt;/Datasource&gt;
  &lt;/Layer&gt;
.......

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004658.html">[Mapnik-users] pdfprinter problem
</A></li>
	<LI>Next message: <A HREF="004660.html">[Mapnik-users] Ogcserver problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4659">[ date ]</a>
              <a href="thread.html#4659">[ thread ]</a>
              <a href="subject.html#4659">[ subject ]</a>
              <a href="author.html#4659">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mapnik-users">More information about the Mapnik-users
mailing list</a><br>
</body></html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mapnik-users] label misplaced
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mapnik-users/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:mapnik-users%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-users%5D%20label%20misplaced&In-Reply-To=%3C9200A70B-A194-4DE1-9B8B-4E8BBE4B6284%40dbsgeo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004223.html">
   <LINK REL="Next"  HREF="004232.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mapnik-users] label misplaced</H1>
    <B>Dane Springmeyer</B> 
    <A HREF="mailto:mapnik-users%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-users%5D%20label%20misplaced&In-Reply-To=%3C9200A70B-A194-4DE1-9B8B-4E8BBE4B6284%40dbsgeo.com%3E"
       TITLE="[Mapnik-users] label misplaced">dane at dbsgeo.com
       </A><BR>
    <I>Tue May  3 23:43:53 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004223.html">[Mapnik-users] label misplaced
</A></li>
        <LI>Next message: <A HREF="004232.html">[Mapnik-users] Mapnik.org status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4231">[ date ]</a>
              <a href="thread.html#4231">[ thread ]</a>
              <a href="subject.html#4231">[ subject ]</a>
              <a href="author.html#4231">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Pierre,

As Jon mentioned, the right way to handle this currently in Mapnik is to split out the multipolygons and label each. This is because the centroid algorithm that mapnik uses is not intended to work with multipolygons. Many Mapnik datasources do have an option to do this splitting called 'multiple_geometries', which if passed, will handle parsing each geometry on its own. But the shapefile plugin does not support this option.

So if you intended to move your data to something like postgis, this will solve it. If you intended to keep it as a shapefile, using ogr2ogr to explode the features may be your best bet for now.

During testing I tried a few other centroid algorithms that work fine for multipolygons (<A HREF="http://trac.mapnik.org/changeset/2866">http://trac.mapnik.org/changeset/2866</A>), and we could consider making it an option to decide which is used.

Any thoughts?

Dane


On May 2, 2011, at 1:24 PM, Pierre Giraud wrote:

&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I faced a weird behavior using mapnik2 and using the TextSymbolizer.
</I>&gt;<i> The label for a specific feature is obviously misplaced.
</I>&gt;<i> Attached is an archive with a simple xml map file, a shapefile with
</I>&gt;<i> the guilty feature and a python script.
</I>&gt;<i> Can someone please give it a try and tell me if I'm missing something ?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Pierre
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Pierre GIRAUD
</I>&gt;<i> G&#233;omaticien, Analyste
</I>&gt;<i> 
</I>&gt;<i> Camptocamp France SAS
</I>&gt;<i> Savoie Technolac, BP 352
</I>&gt;<i> 73377 Le Bourget du Lac, Cedex
</I>&gt;<i> 
</I>&gt;<i> Tel : 00 33 4 79 44 44 93
</I>&gt;<i> Mail : <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">pierre.giraud at camptocamp.com</A>
</I>&gt;<i> <A HREF="http://www.camptocamp.com">http://www.camptocamp.com</A>
</I>&gt;<i> &lt;england.tar.gz&gt;_______________________________________________
</I>&gt;<i> Mapnik-users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">Mapnik-users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">https://lists.berlios.de/mailman/listinfo/mapnik-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004223.html">[Mapnik-users] label misplaced
</A></li>
	<LI>Next message: <A HREF="004232.html">[Mapnik-users] Mapnik.org status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4231">[ date ]</a>
              <a href="thread.html#4231">[ thread ]</a>
              <a href="subject.html#4231">[ subject ]</a>
              <a href="author.html#4231">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mapnik-users">More information about the Mapnik-users
mailing list</a><br>
</body></html>

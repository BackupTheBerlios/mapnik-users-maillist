<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mapnik-users] Failed to render PostGIS Layers using	Mapnik	0.6.1 Windows/PostgreSQL 8.4/PostGIS 1.4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mapnik-users/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:mapnik-users%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-users%5D%20Failed%20to%20render%20PostGIS%20Layers%20using%0A%09Mapnik%090.6.1%20Windows/PostgreSQL%208.4/PostGIS%201.4&In-Reply-To=%3CBB97768F-06AC-4209-819E-4D9028073A80%40hailmail.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002704.html">
   <LINK REL="Next"  HREF="002706.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mapnik-users] Failed to render PostGIS Layers using	Mapnik	0.6.1 Windows/PostgreSQL 8.4/PostGIS 1.4</H1>
    <B>Dane Springmeyer</B> 
    <A HREF="mailto:mapnik-users%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-users%5D%20Failed%20to%20render%20PostGIS%20Layers%20using%0A%09Mapnik%090.6.1%20Windows/PostgreSQL%208.4/PostGIS%201.4&In-Reply-To=%3CBB97768F-06AC-4209-819E-4D9028073A80%40hailmail.net%3E"
       TITLE="[Mapnik-users] Failed to render PostGIS Layers using	Mapnik	0.6.1 Windows/PostgreSQL 8.4/PostGIS 1.4">blake at hailmail.net
       </A><BR>
    <I>Tue Dec 29 04:11:53 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002704.html">[Mapnik-users] Failed to render PostGIS Layers using Mapnik	0.6.1 Windows/PostgreSQL 8.4/PostGIS 1.4
</A></li>
        <LI>Next message: <A HREF="002706.html">[Mapnik-users] shapefile-plugin isn't working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2705">[ date ]</a>
              <a href="thread.html#2705">[ thread ]</a>
              <a href="subject.html#2705">[ subject ]</a>
              <a href="author.html#2705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tobias, the fixes are in the Mapnik 0.7 branch, will be in the  
upcoming 0.7.0 tag, and are also in trunk. There were many - see the  
changelog for more details. The push to the 0.7.0 release is a higher  
priority than documentation at this point (I'm always open to folks  
requesting specific docs) but a writeup will hopefully be in the works  
afterword.

Dane

--- \o/ ---
Sent from my phone

On Dec 28, 2009, at 5:34 PM, Tobias Wendorff &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">tobias.wendorff at uni-dortmund.de</A> 
 &gt; wrote:

&gt;<i> Dane,
</I>&gt;<i>
</I>&gt;<i> where are you going to put the fix? trunk? branches? tags? ;-)
</I>&gt;<i>
</I>&gt;<i> Best,
</I>&gt;<i> Tobias
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Dane Springmeyer schrieb:
</I>&gt;&gt;<i> Mel. Great, glad that helped you fix the problem! Thanks for  
</I>&gt;&gt;<i> reporting back, but in the future remember to cc the list. Cheers,
</I>&gt;&gt;<i> Dane --- \o/ ---
</I>&gt;&gt;<i> Sent from my phone
</I>&gt;&gt;<i> On Dec 28, 2009, at 11:21 AM, mel yuanhang &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">mel.gis at gmail.com</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">mel.gis at gmail.com</A> 
</I>&gt;&gt;<i> &gt;&gt; wrote:
</I>&gt;&gt;&gt;<i> Thank you very much Dane.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> After following your instructions I fixed the problem.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In my case, it might be a QGIS problem. As I imported a shapefile  
</I>&gt;&gt;&gt;<i> into PostGIS, because of my typo the PostGIS table has a slightly  
</I>&gt;&gt;&gt;<i> different name. Somehow, the name shows in the geometry_columns  
</I>&gt;&gt;&gt;<i> table is the same as the old shapefile. Once I applied the  
</I>&gt;&gt;&gt;<i> populate_spatial_column to my table, the problem is solved.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Happy new year!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mel
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Mon, Dec 28, 2009 at 10:38 AM, Dane Springmeyer &lt; &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">blake at hailmail.net</A> 
</I>&gt;&gt;&gt;<i> &gt;<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">blake at hailmail.net</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">blake at hailmail.net</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Hello Mel,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    In general the error you've pasted from the Postgres logs will be
</I>&gt;&gt;&gt;<i>    avoided in the upcoming 0.7.0 release. Iv'e recently added to and
</I>&gt;&gt;&gt;<i>    updated the postgis plugin with new features and error messages
</I>&gt;&gt;&gt;<i>    that should avoid this problem in the future(it is a common one  
</I>&gt;&gt;&gt;<i> so
</I>&gt;&gt;&gt;<i>    sorry you've run into it)  it should also make my below
</I>&gt;&gt;&gt;<i>    explanation uneeded or at least shorter in the future.  What is
</I>&gt;&gt;&gt;<i>    happening is that the geometry field for your table is unknown,
</I>&gt;&gt;&gt;<i>    llikely because the table lacks a record in the geometry_columns
</I>&gt;&gt;&gt;<i>    table (but it can also occur for other reasons).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Also, it appears that those logs do not exactly correspond to the
</I>&gt;&gt;&gt;<i>    query that is in the 'table' param in your XML. I notice the
</I>&gt;&gt;&gt;<i>    characteristic extra syntax of 'WHERE GeometryType(&quot;the_geom&quot;) IN
</I>&gt;&gt;&gt;<i>    ' as coming from QGIS/Quantumnik. Do you perhaps have more than
</I>&gt;&gt;&gt;<i>    one geometry field? You can try specifying
</I>&gt;&gt;&gt;<i>    geometry_field=&quot;the_geom&quot; in your XML datasource parmeters, but
</I>&gt;&gt;&gt;<i>    overall I would make sure you have a proper record in the
</I>&gt;&gt;&gt;<i>    geometry_columns. PostGIS 1.4 has a nice function called
</I>&gt;&gt;&gt;<i>    'populate_geometry_columns' (or something like that) which may
</I>&gt;&gt;&gt;<i>    help. Mapnik0.6.1 needs this metadata, but in mapnik0.7.0 if you
</I>&gt;&gt;&gt;<i>    supply the geometry_field and SRID then this
</I>&gt;&gt;&gt;<i>    metadata will be optional.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Lastly, it appears that the layer srs parameter is wrong which  
</I>&gt;&gt;&gt;<i> may
</I>&gt;&gt;&gt;<i>    prevent your map from showing any features once you get the query
</I>&gt;&gt;&gt;<i>    working.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    I would recommend installing nik2img and running it on your XML
</I>&gt;&gt;&gt;<i>    while fixing the layer srs to your correct projection for your
</I>&gt;&gt;&gt;<i>    data and changing the 'table' parameter to just your table name
</I>&gt;&gt;&gt;<i>    without a subselect.  If you still get errors in your logs after
</I>&gt;&gt;&gt;<i>    confirming the geometry_columns are correct for your table the.
</I>&gt;&gt;&gt;<i>    Please send the error again.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Dane
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    --- \o/ ---
</I>&gt;&gt;&gt;<i>    Sent from my phone
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    On Dec 28, 2009, at 7:33 AM, mel yuanhang &lt;
</I>&gt;&gt;&gt;<i>    &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">mel.gis at gmail.com</A>&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">mel.gis at gmail.com</A>
</I>&gt;&gt;&gt;<i>    &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">mel.gis at gmail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        Hi,
</I>&gt;&gt;&gt;<i>        I could not render a PostGIS layer using the following  
</I>&gt;&gt;&gt;<i> setting
</I>&gt;&gt;&gt;<i>        on WindowsXP,
</I>&gt;&gt;&gt;<i>        -Mapnik 0.6.1
</I>&gt;&gt;&gt;<i>        -PostgreSQL 8.4/PostGIS 1.4
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        It works fine for shapefiles. But as I connect to a PostGIS
</I>&gt;&gt;&gt;<i>        Layer, I got the following errors in the Postgresql log file,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        2009-12-24 14:05:03 ESTERROR:  zero-length delimited
</I>&gt;&gt;&gt;<i>        identifier at or near &quot;&quot;&quot;&quot; at character 17
</I>&gt;&gt;&gt;<i>        2009-12-24 14:05:03 ESTSTATEMENT:  SELECT AsBinary(&quot;&quot;,'NDR')
</I>&gt;&gt;&gt;<i>        AS geom from (SELECT * FROM &quot;mains_update_dlz&quot; WHERE
</I>&gt;&gt;&gt;<i>        GeometryType(&quot;the_geom&quot;) IN ('LINESTRING','MULTILINESTRING'))
</I>&gt;&gt;&gt;<i>        as &quot;mains_update_dlz&quot; WHERE &quot;&quot; &amp;&amp; SetSRID('BOX3D 
</I>&gt;&gt;&gt;<i> (1835078.82466
</I>&gt;&gt;&gt;<i>        710209.522025,1842753.74984 713266.403181)'::box3d,0)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        The XML file is shown below,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        &lt;?xml version=&quot;1.0&quot; ?&gt;&lt;Map bgcolor=&quot;rgb(255,255,255)&quot;
</I>&gt;&gt;&gt;<i>        srs=&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;&gt;
</I>&gt;&gt;&gt;<i>           &lt;Style name=&quot;mains_update_dlz_style&quot;&gt;
</I>&gt;&gt;&gt;<i>               &lt;Rule&gt;
</I>&gt;&gt;&gt;<i>                   &lt;LineSymbolizer&gt;
</I>&gt;&gt;&gt;<i>                       &lt;CssParameter
</I>&gt;&gt;&gt;<i>        name=&quot;stroke&quot;&gt;rgb(229,210,191)&lt;/CssParameter&gt;
</I>&gt;&gt;&gt;<i>                       &lt;CssParameter
</I>&gt;&gt;&gt;<i>        name=&quot;stroke-width&quot;&gt;0.96&lt;/CssParameter&gt;
</I>&gt;&gt;&gt;<i>                       &lt;CssParameter
</I>&gt;&gt;&gt;<i>        name=&quot;stroke-linejoin&quot;&gt;bevel&lt;/CssParameter&gt;
</I>&gt;&gt;&gt;<i>                       &lt;CssParameter
</I>&gt;&gt;&gt;<i>        name=&quot;stroke-linecap&quot;&gt;square&lt;/CssParameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;/LineSymbolizer&gt;
</I>&gt;&gt;&gt;<i>               &lt;/Rule&gt;
</I>&gt;&gt;&gt;<i>           &lt;/Style&gt;
</I>&gt;&gt;&gt;<i>           &lt;Layer clear_label_cache=&quot;0&quot; name=&quot;mains_update_dlz&quot;
</I>&gt;&gt;&gt;<i>        srs=&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;  
</I>&gt;&gt;&gt;<i> status=&quot;1&quot;&gt;
</I>&gt;&gt;&gt;<i>               &lt;StyleName&gt;mains_update_dlz_style&lt;/StyleName&gt;
</I>&gt;&gt;&gt;<i>               &lt;Datasource&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;dbname&quot;&gt;postgis&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter
</I>&gt;&gt;&gt;<i>         
</I>&gt;&gt;&gt;<i> name= 
</I>&gt;&gt;&gt;<i> &quot;extent&quot;&gt;1835078.82466,710209.522025,1842753.74984,713266.403181&lt;/ 
</I>&gt;&gt;&gt;<i> Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;host&quot;&gt;localhost&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;password&quot;&gt;postgres&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;port&quot;&gt;5432&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;estimate_extent&quot;&gt;false&lt;/ 
</I>&gt;&gt;&gt;<i> Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;table&quot;&gt;(SELECT * FROM
</I>&gt;&gt;&gt;<i>        mains_update_dlz) as mains_update_dlz&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;type&quot;&gt;postgis&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>                   &lt;Parameter name=&quot;user&quot;&gt;postgres&lt;/Parameter&gt;
</I>&gt;&gt;&gt;<i>               &lt;/Datasource&gt;
</I>&gt;&gt;&gt;<i>           &lt;/Layer&gt;
</I>&gt;&gt;&gt;<i>        &lt;/Map&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        Thank you very much,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        Mel
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        _______________________________________________
</I>&gt;&gt;&gt;<i>        Mapnik-users mailing list
</I>&gt;&gt;&gt;<i>        &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">Mapnik-users at lists.berlios.de</A>&gt;Mapnik- 
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">users at lists.berlios.de</A>
</I>&gt;&gt;&gt;<i>        &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">Mapnik-users at lists.berlios.de</A>&gt;
</I>&gt;&gt;&gt;<i>        &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">https://lists.berlios.de/mailman/listinfo/mapnik-users</A>&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">https://lists.berlios.de/mailman/listinfo/mapnik-users</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> --- 
</I>&gt;&gt;<i> ---------------------------------------------------------------------
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mapnik-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">Mapnik-users at lists.berlios.de</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-users">https://lists.berlios.de/mailman/listinfo/mapnik-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002704.html">[Mapnik-users] Failed to render PostGIS Layers using Mapnik	0.6.1 Windows/PostgreSQL 8.4/PostGIS 1.4
</A></li>
	<LI>Next message: <A HREF="002706.html">[Mapnik-users] shapefile-plugin isn't working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2705">[ date ]</a>
              <a href="thread.html#2705">[ thread ]</a>
              <a href="subject.html#2705">[ subject ]</a>
              <a href="author.html#2705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mapnik-users">More information about the Mapnik-users
mailing list</a><br>
</body></html>
